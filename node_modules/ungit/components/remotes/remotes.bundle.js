(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){

var ko = require('knockout');
var _ = require('lodash');
var async = require('async');
var components = require('ungit-components');
var programEvents = require('ungit-program-events');

components.register('remotes', function(args) {
  return new RemotesViewModel(args.server, args.repoPath);
});

function RemotesViewModel(server, repoPath) {
  var self = this;
  this.repoPath = repoPath;
  this.server = server;
  this.remotes = ko.observable([]);
  this.currentRemote = ko.observable(null);
  this.currentRemote.subscribe(function(value) {
    programEvents.dispatch({ event: 'current-remote-changed', newRemote: value });
  });
  this.fetchLabel = ko.computed(function() {
    if (self.currentRemote()) return 'Fetch from ' + self.currentRemote();
    else return 'No remotes specified';
  })

  this.fetchingProgressBar = components.create('progressBar', { predictionMemoryKey: 'fetching-' + this.repoPath, temporary: true });

  this.fetchEnabled = ko.computed(function() {
    return self.remotes().length > 0;
  });

  this.shouldAutoFetch = ungit.config.autoFetch;
  this.updateRemotes();
}
RemotesViewModel.prototype.updateNode = function(parentElement) {
  ko.renderTemplate('remotes', this, {}, parentElement);
}
RemotesViewModel.prototype.clickFetch = function() { this.fetch({ nodes: true, tags: true }); }
RemotesViewModel.prototype.onProgramEvent = function(event) {
  if (event.event == 'request-credentials') this.fetchingProgressBar.pause();
  else if (event.event == 'request-credentials-response') this.fetchingProgressBar.unpause();
  else if (event.event == 'request-fetch-tags') this.fetch({ tags: true });
}
RemotesViewModel.prototype.fetch = function(options) {
  if (this.fetchingProgressBar.running()) return;
  var self = this;

  this.fetchingProgressBar.start();
  var jobs = [];
  if (options.tags) jobs.push(function(done) { self.server.get('/remote/tags', { path: self.repoPath, remote: self.currentRemote() }, done); });
  if (options.nodes) jobs.push(function(done) { self.server.post('/fetch', { path: self.repoPath, remote: self.currentRemote() }, done);  });
  async.parallel(jobs, function(err, result) {
    self.fetchingProgressBar.stop();

    if (!err && options.tags) programEvents.dispatch({ event: 'remote-tags-update', tags: result[0] });
  });
}

RemotesViewModel.prototype.updateRemotes = function() {
  var self = this;
  this.server.get('/remotes', { path: this.repoPath }, function(err, remotes) {
    if (err && err.errorCode == 'not-a-repository') return true;
    if (err) return;
    remotes = remotes.map(function(remote) {
      return {
        name: remote,
        changeRemote: function() { self.currentRemote(remote) }
      }
    });
    self.remotes(remotes);
    if (!self.currentRemote() && remotes.length > 0) {
      if (_.find(remotes, { 'name': 'origin' })) // default to origin if it exists
        self.currentRemote('origin');
      else // otherwise take the first one
        self.currentRemote(remotes[0].name);
      if (self.shouldAutoFetch) {
        self.fetch({ nodes: true, tags: true });
      }
    }
    self.shouldAutoFetch = false;
  });
}
RemotesViewModel.prototype.showAddRemoteDialog = function() {
  var self = this;
  var diag = components.create('addremotedialog');
  diag.closed.add(function() {
    if (diag.isSubmitted()) {
      self.server.post('/remotes/' + encodeURIComponent(diag.name()), { path: self.repoPath, url: diag.url() }, function(err, res) {
        if (err) return;
        self.updateRemotes();
      })
    }
  });
  programEvents.dispatch({ event: 'request-show-dialog', dialog: diag });
}

RemotesViewModel.prototype.remoteRemove = function(remote) {
  var self = this;
  var diag = components.create('yesnodialog', { title: 'Are you sure?', details: 'This operation cannot be undone with ungit.'});
  diag.closed.add(function() {
    if (diag.result()) {
      self.fetchingProgressBar.start();
      self.server.del('/remotes/' + remote.name, { path: self.repoPath }, function(err, result) {
        if (err) {
          console.log(err);
          return;
        }

        self.updateRemotes();
        self.fetchingProgressBar.stop();
      });
    }
  });
  programEvents.dispatch({ event: 'request-show-dialog', dialog: diag });
}

},{"async":"async","knockout":"knockout","lodash":"lodash","ungit-components":"ungit-components","ungit-program-events":"ungit-program-events"}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb21wb25lbnRzL3JlbW90ZXMvcmVtb3Rlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG52YXIga28gPSByZXF1aXJlKCdrbm9ja291dCcpO1xudmFyIF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbnZhciBhc3luYyA9IHJlcXVpcmUoJ2FzeW5jJyk7XG52YXIgY29tcG9uZW50cyA9IHJlcXVpcmUoJ3VuZ2l0LWNvbXBvbmVudHMnKTtcbnZhciBwcm9ncmFtRXZlbnRzID0gcmVxdWlyZSgndW5naXQtcHJvZ3JhbS1ldmVudHMnKTtcblxuY29tcG9uZW50cy5yZWdpc3RlcigncmVtb3RlcycsIGZ1bmN0aW9uKGFyZ3MpIHtcbiAgcmV0dXJuIG5ldyBSZW1vdGVzVmlld01vZGVsKGFyZ3Muc2VydmVyLCBhcmdzLnJlcG9QYXRoKTtcbn0pO1xuXG5mdW5jdGlvbiBSZW1vdGVzVmlld01vZGVsKHNlcnZlciwgcmVwb1BhdGgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnJlcG9QYXRoID0gcmVwb1BhdGg7XG4gIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICB0aGlzLnJlbW90ZXMgPSBrby5vYnNlcnZhYmxlKFtdKTtcbiAgdGhpcy5jdXJyZW50UmVtb3RlID0ga28ub2JzZXJ2YWJsZShudWxsKTtcbiAgdGhpcy5jdXJyZW50UmVtb3RlLnN1YnNjcmliZShmdW5jdGlvbih2YWx1ZSkge1xuICAgIHByb2dyYW1FdmVudHMuZGlzcGF0Y2goeyBldmVudDogJ2N1cnJlbnQtcmVtb3RlLWNoYW5nZWQnLCBuZXdSZW1vdGU6IHZhbHVlIH0pO1xuICB9KTtcbiAgdGhpcy5mZXRjaExhYmVsID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgaWYgKHNlbGYuY3VycmVudFJlbW90ZSgpKSByZXR1cm4gJ0ZldGNoIGZyb20gJyArIHNlbGYuY3VycmVudFJlbW90ZSgpO1xuICAgIGVsc2UgcmV0dXJuICdObyByZW1vdGVzIHNwZWNpZmllZCc7XG4gIH0pXG5cbiAgdGhpcy5mZXRjaGluZ1Byb2dyZXNzQmFyID0gY29tcG9uZW50cy5jcmVhdGUoJ3Byb2dyZXNzQmFyJywgeyBwcmVkaWN0aW9uTWVtb3J5S2V5OiAnZmV0Y2hpbmctJyArIHRoaXMucmVwb1BhdGgsIHRlbXBvcmFyeTogdHJ1ZSB9KTtcblxuICB0aGlzLmZldGNoRW5hYmxlZCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBzZWxmLnJlbW90ZXMoKS5sZW5ndGggPiAwO1xuICB9KTtcblxuICB0aGlzLnNob3VsZEF1dG9GZXRjaCA9IHVuZ2l0LmNvbmZpZy5hdXRvRmV0Y2g7XG4gIHRoaXMudXBkYXRlUmVtb3RlcygpO1xufVxuUmVtb3Rlc1ZpZXdNb2RlbC5wcm90b3R5cGUudXBkYXRlTm9kZSA9IGZ1bmN0aW9uKHBhcmVudEVsZW1lbnQpIHtcbiAga28ucmVuZGVyVGVtcGxhdGUoJ3JlbW90ZXMnLCB0aGlzLCB7fSwgcGFyZW50RWxlbWVudCk7XG59XG5SZW1vdGVzVmlld01vZGVsLnByb3RvdHlwZS5jbGlja0ZldGNoID0gZnVuY3Rpb24oKSB7IHRoaXMuZmV0Y2goeyBub2RlczogdHJ1ZSwgdGFnczogdHJ1ZSB9KTsgfVxuUmVtb3Rlc1ZpZXdNb2RlbC5wcm90b3R5cGUub25Qcm9ncmFtRXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoZXZlbnQuZXZlbnQgPT0gJ3JlcXVlc3QtY3JlZGVudGlhbHMnKSB0aGlzLmZldGNoaW5nUHJvZ3Jlc3NCYXIucGF1c2UoKTtcbiAgZWxzZSBpZiAoZXZlbnQuZXZlbnQgPT0gJ3JlcXVlc3QtY3JlZGVudGlhbHMtcmVzcG9uc2UnKSB0aGlzLmZldGNoaW5nUHJvZ3Jlc3NCYXIudW5wYXVzZSgpO1xuICBlbHNlIGlmIChldmVudC5ldmVudCA9PSAncmVxdWVzdC1mZXRjaC10YWdzJykgdGhpcy5mZXRjaCh7IHRhZ3M6IHRydWUgfSk7XG59XG5SZW1vdGVzVmlld01vZGVsLnByb3RvdHlwZS5mZXRjaCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgaWYgKHRoaXMuZmV0Y2hpbmdQcm9ncmVzc0Jhci5ydW5uaW5nKCkpIHJldHVybjtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIHRoaXMuZmV0Y2hpbmdQcm9ncmVzc0Jhci5zdGFydCgpO1xuICB2YXIgam9icyA9IFtdO1xuICBpZiAob3B0aW9ucy50YWdzKSBqb2JzLnB1c2goZnVuY3Rpb24oZG9uZSkgeyBzZWxmLnNlcnZlci5nZXQoJy9yZW1vdGUvdGFncycsIHsgcGF0aDogc2VsZi5yZXBvUGF0aCwgcmVtb3RlOiBzZWxmLmN1cnJlbnRSZW1vdGUoKSB9LCBkb25lKTsgfSk7XG4gIGlmIChvcHRpb25zLm5vZGVzKSBqb2JzLnB1c2goZnVuY3Rpb24oZG9uZSkgeyBzZWxmLnNlcnZlci5wb3N0KCcvZmV0Y2gnLCB7IHBhdGg6IHNlbGYucmVwb1BhdGgsIHJlbW90ZTogc2VsZi5jdXJyZW50UmVtb3RlKCkgfSwgZG9uZSk7ICB9KTtcbiAgYXN5bmMucGFyYWxsZWwoam9icywgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICBzZWxmLmZldGNoaW5nUHJvZ3Jlc3NCYXIuc3RvcCgpO1xuXG4gICAgaWYgKCFlcnIgJiYgb3B0aW9ucy50YWdzKSBwcm9ncmFtRXZlbnRzLmRpc3BhdGNoKHsgZXZlbnQ6ICdyZW1vdGUtdGFncy11cGRhdGUnLCB0YWdzOiByZXN1bHRbMF0gfSk7XG4gIH0pO1xufVxuXG5SZW1vdGVzVmlld01vZGVsLnByb3RvdHlwZS51cGRhdGVSZW1vdGVzID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5zZXJ2ZXIuZ2V0KCcvcmVtb3RlcycsIHsgcGF0aDogdGhpcy5yZXBvUGF0aCB9LCBmdW5jdGlvbihlcnIsIHJlbW90ZXMpIHtcbiAgICBpZiAoZXJyICYmIGVyci5lcnJvckNvZGUgPT0gJ25vdC1hLXJlcG9zaXRvcnknKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoZXJyKSByZXR1cm47XG4gICAgcmVtb3RlcyA9IHJlbW90ZXMubWFwKGZ1bmN0aW9uKHJlbW90ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogcmVtb3RlLFxuICAgICAgICBjaGFuZ2VSZW1vdGU6IGZ1bmN0aW9uKCkgeyBzZWxmLmN1cnJlbnRSZW1vdGUocmVtb3RlKSB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgc2VsZi5yZW1vdGVzKHJlbW90ZXMpO1xuICAgIGlmICghc2VsZi5jdXJyZW50UmVtb3RlKCkgJiYgcmVtb3Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoXy5maW5kKHJlbW90ZXMsIHsgJ25hbWUnOiAnb3JpZ2luJyB9KSkgLy8gZGVmYXVsdCB0byBvcmlnaW4gaWYgaXQgZXhpc3RzXG4gICAgICAgIHNlbGYuY3VycmVudFJlbW90ZSgnb3JpZ2luJyk7XG4gICAgICBlbHNlIC8vIG90aGVyd2lzZSB0YWtlIHRoZSBmaXJzdCBvbmVcbiAgICAgICAgc2VsZi5jdXJyZW50UmVtb3RlKHJlbW90ZXNbMF0ubmFtZSk7XG4gICAgICBpZiAoc2VsZi5zaG91bGRBdXRvRmV0Y2gpIHtcbiAgICAgICAgc2VsZi5mZXRjaCh7IG5vZGVzOiB0cnVlLCB0YWdzOiB0cnVlIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBzZWxmLnNob3VsZEF1dG9GZXRjaCA9IGZhbHNlO1xuICB9KTtcbn1cblJlbW90ZXNWaWV3TW9kZWwucHJvdG90eXBlLnNob3dBZGRSZW1vdGVEaWFsb2cgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZGlhZyA9IGNvbXBvbmVudHMuY3JlYXRlKCdhZGRyZW1vdGVkaWFsb2cnKTtcbiAgZGlhZy5jbG9zZWQuYWRkKGZ1bmN0aW9uKCkge1xuICAgIGlmIChkaWFnLmlzU3VibWl0dGVkKCkpIHtcbiAgICAgIHNlbGYuc2VydmVyLnBvc3QoJy9yZW1vdGVzLycgKyBlbmNvZGVVUklDb21wb25lbnQoZGlhZy5uYW1lKCkpLCB7IHBhdGg6IHNlbGYucmVwb1BhdGgsIHVybDogZGlhZy51cmwoKSB9LCBmdW5jdGlvbihlcnIsIHJlcykge1xuICAgICAgICBpZiAoZXJyKSByZXR1cm47XG4gICAgICAgIHNlbGYudXBkYXRlUmVtb3RlcygpO1xuICAgICAgfSlcbiAgICB9XG4gIH0pO1xuICBwcm9ncmFtRXZlbnRzLmRpc3BhdGNoKHsgZXZlbnQ6ICdyZXF1ZXN0LXNob3ctZGlhbG9nJywgZGlhbG9nOiBkaWFnIH0pO1xufVxuXG5SZW1vdGVzVmlld01vZGVsLnByb3RvdHlwZS5yZW1vdGVSZW1vdmUgPSBmdW5jdGlvbihyZW1vdGUpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZGlhZyA9IGNvbXBvbmVudHMuY3JlYXRlKCd5ZXNub2RpYWxvZycsIHsgdGl0bGU6ICdBcmUgeW91IHN1cmU/JywgZGV0YWlsczogJ1RoaXMgb3BlcmF0aW9uIGNhbm5vdCBiZSB1bmRvbmUgd2l0aCB1bmdpdC4nfSk7XG4gIGRpYWcuY2xvc2VkLmFkZChmdW5jdGlvbigpIHtcbiAgICBpZiAoZGlhZy5yZXN1bHQoKSkge1xuICAgICAgc2VsZi5mZXRjaGluZ1Byb2dyZXNzQmFyLnN0YXJ0KCk7XG4gICAgICBzZWxmLnNlcnZlci5kZWwoJy9yZW1vdGVzLycgKyByZW1vdGUubmFtZSwgeyBwYXRoOiBzZWxmLnJlcG9QYXRoIH0sIGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYudXBkYXRlUmVtb3RlcygpO1xuICAgICAgICBzZWxmLmZldGNoaW5nUHJvZ3Jlc3NCYXIuc3RvcCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgcHJvZ3JhbUV2ZW50cy5kaXNwYXRjaCh7IGV2ZW50OiAncmVxdWVzdC1zaG93LWRpYWxvZycsIGRpYWxvZzogZGlhZyB9KTtcbn1cbiJdfQ==
